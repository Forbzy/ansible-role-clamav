---

- name: Include variables suitable to our OS Family
  include_vars: "{{ ansible_os_family }}.yml"

- name: Include tasks suitable to our OS Family
  include: "{{ ansible_os_family }}.yml"

- name: Start clamav daemon
  service:
    name: clamav-daemon
    state: started
    enabled: yes

- name: Start freshclam daemon
  service:
    name: clamav-freshclam
    state: started
    enabled: yes

- action: 
    shell: "if [[ `cat /var/log/clamav/freshclam.log|grep daily.cld | tail -n1| awk '{print $9,$10,$11}'` == 'up to date' ]]; then echo 'OK: Freshclam Current'; exit 0; else echo 'Error: Freshclam needs updating'; exit 1; fi"
  register: result
  until: result.stdout.find("OK") != -1
  retries: 10
  delay: 20
